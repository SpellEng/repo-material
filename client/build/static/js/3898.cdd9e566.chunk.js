"use strict";(self.webpackChunkspelleng=self.webpackChunkspelleng||[]).push([[3898],{25331:(e,l,s)=>{s.d(l,{A:()=>o});s(65043);const i=s.p+"static/media/loading.f3b83b01f3a98a17618e.gif";var n=s(70579);const o=()=>(0,n.jsx)("img",{src:i,alt:"Spinning Tom Nook Loading Icon",className:"loadingSpinner"})},93884:(e,l,s)=>{s.d(l,{$p:()=>o,C9:()=>n});var i=s(22019);const n=e=>{i.Ay.success({className:"ant-message",content:e,duration:4,style:{marginTop:"40px"}})},o=e=>{i.Ay.error({className:"ant-message",content:e,duration:4,style:{marginTop:"40px"}})}},55508:(e,l,s)=>{s.r(l),s.d(l,{default:()=>I});var i=s(87021),n=s(65043),o=s(15444),a=s(2761),d=s(54522),t=s(53722),r=s(4394),c=s(6036),v=s(86213),u=s(93884),m=s(47196),g=s(96058),p=s(70579);const h=(e,l)=>{var s,i,n;return null!==e&&void 0!==e&&e.url?null!==e&&void 0!==e&&null!==(s=e.type)&&void 0!==s&&s.startsWith("video")?(0,p.jsx)("video",{src:null===e||void 0===e?void 0:e.url,controls:!0,className:"messageFile"}):null!==e&&void 0!==e&&null!==(i=e.format)&&void 0!==i&&i.startsWith("pdf")?(0,p.jsxs)("a",{href:null===e||void 0===e?void 0:e.url,download:!0,target:"_blank",className:"messageFileLink d-flex align-items-center gap-2",children:[(0,p.jsx)(m.jKN,{})," ",null===e||void 0===e?void 0:e.name,".pdf"]}):null!==e&&void 0!==e&&null!==(n=e.type)&&void 0!==n&&n.startsWith("image")?(0,p.jsxs)("div",{className:"messageFile",children:[(0,p.jsx)("img",{src:null===e||void 0===e?void 0:e.url,alt:"Uploaded file"}),(0,p.jsx)("br",{}),!l&&(0,p.jsx)("a",{href:null===e||void 0===e?void 0:e.url,download:!0,target:"_blank",className:"mt-2 d-flex align-items-center justify-content-center gap-2",children:"Download"})]}):(0,p.jsxs)("a",{href:null===e||void 0===e?void 0:e.url,target:"_blank",download:!0,className:"messageFileLink d-flex align-items-center gap-2",children:[(0,p.jsx)(g.Bn5,{})," ",null===e||void 0===e?void 0:e.name]}):null};var x=s(25331);const j=e=>{let{value:l,updateFileFun:s}=e;const[o,a]=(0,n.useState)(!1),d={beforeUpload:e=>{console.log(e);if(!(e.type.startsWith("image/")||e.type.startsWith("video/")||"application/pdf"===e.type||"application/vnd.openxmlformats-officedocument.wordprocessingml.document"===e.type))return(0,u.$p)("You can only upload image, video, PDF, or DOCX files!"),c.A.LIST_IGNORE;{a(!0);const l=new FormData;l.append("file",e),v.A.post("".concat("https://www.spelleng.com/api","/files/upload"),l,{headers:{authorization:"Bearer "+localStorage.getItem("token")}}).then((e=>{a(!1),200===e.status?s(e.data):(0,u.$p)(e.data.errorMessage)})).catch((e=>{a(!1),console.log(e),(0,u.$p)(null===e||void 0===e?void 0:e.message)}))}},maxCount:1};return(0,p.jsxs)("div",{className:"file-upload",children:[(0,p.jsx)(c.A,{...d,multiple:!1,showUploadList:!1,children:(0,p.jsx)(i.Ay,{children:"\ud83d\udcce"})}),o?(0,p.jsx)(x.A,{}):h(l,!0)]})},{TextArea:f}=o.A,N=e=>{var l,s;let{receiver:o,messages:c,sender:v,onSendMessage:u}=e;const[m,g]=(0,n.useState)(""),[x,N]=(0,n.useState)(null),y=(0,n.useRef)(null);(0,n.useEffect)((()=>{w()}),[c]);const w=()=>{y.current&&y.current.scrollIntoView({behavior:"smooth"})};return(0,p.jsxs)("div",{className:"chat-window",children:[(0,p.jsx)("div",{className:"chat-header",children:(0,p.jsxs)("div",{className:"d-flex gap-2 align-items-center",children:[(0,p.jsx)(a.A,{src:null===o||void 0===o||null===(l=o.picture)||void 0===l?void 0:l.url,icon:!(null!==o&&void 0!==o&&null!==(s=o.picture)&&void 0!==s&&s.url)&&(0,p.jsx)(t.A,{})}),(0,p.jsx)("span",{children:null===o||void 0===o?void 0:o.fullName})]})}),(0,p.jsx)("div",{className:"messages",children:(null===c||void 0===c?void 0:c.length)>0&&(0,p.jsx)(d.A,{itemLayout:"horizontal",dataSource:c,renderItem:e=>(0,p.jsx)(d.A.Item,{ref:y,className:"message ".concat((null===e||void 0===e?void 0:e.sender)===(null===v||void 0===v?void 0:v._id)?"my-message":""),children:(0,p.jsx)(d.A.Item.Meta,{avatar:(0,p.jsx)(a.A,{icon:(0,p.jsx)(t.A,{})}),title:(null===e||void 0===e?void 0:e.sender)===(null===v||void 0===v?void 0:v._id)?"Me":null===o||void 0===o?void 0:o.fullName,description:(0,p.jsxs)("div",{children:[h(null===e||void 0===e?void 0:e.file),(0,p.jsx)("p",{children:null===e||void 0===e?void 0:e.message})]})})})})}),(0,p.jsxs)("div",{className:"chat-input",children:[(0,p.jsx)(f,{value:m,onChange:e=>g(e.target.value),placeholder:"Type your message here",autoSize:{minRows:2,maxRows:6}}),(0,p.jsx)(i.Ay,{type:"primary",icon:(0,p.jsx)(r.A,{}),onClick:()=>{""!==m&&(u(m,x),g(""),N(null))},children:"Send"})]}),(0,p.jsx)(j,{value:x,updateFileFun:e=>N(e)})]})};var y=s(31103);const{Search:w}=o.A,A=e=>{let{users:l,onSelectUser:s,selectedUser:i}=e;const[o,r]=(0,n.useState)(""),c=null===l||void 0===l?void 0:l.filter((e=>{var l,s,i,n;let a=(null===(l=(0,y.wR)())||void 0===l?void 0:l._id)===(null===e||void 0===e||null===(s=e.receiver)||void 0===s?void 0:s._id)?null===e||void 0===e?void 0:e.sender:null===e||void 0===e?void 0:e.receiver;return null===a||void 0===a||null===(i=a.fullName)||void 0===i||null===(n=i.toUpperCase())||void 0===n?void 0:n.includes(null===o||void 0===o?void 0:o.toUpperCase())}));return(0,p.jsxs)("div",{className:"user-list",children:[(0,p.jsxs)("div",{className:"header",children:[(0,p.jsx)("h3",{children:"All Conversations"}),(0,p.jsx)(w,{size:"large",allowClear:!0,placeholder:"Search",className:"w-100",onChange:e=>{r(e.target.value)}})]}),(0,p.jsx)(d.A,{itemLayout:"horizontal",dataSource:c,renderItem:e=>{var l,n,o,r,c,v;let u=(null===(l=(0,y.wR)())||void 0===l?void 0:l._id)===(null===e||void 0===e||null===(n=e.receiver)||void 0===n?void 0:n._id)?null===e||void 0===e?void 0:e.sender:null===e||void 0===e?void 0:e.receiver;return(0,p.jsx)(d.A.Item,{className:i===(null===u||void 0===u?void 0:u._id)?"active":"",onClick:()=>s(null===u||void 0===u?void 0:u._id),children:(0,p.jsx)(d.A.Item.Meta,{avatar:(0,p.jsx)(a.A,{src:null===u||void 0===u||null===(o=u.picture)||void 0===o?void 0:o.url,icon:!(null!==u&&void 0!==u&&null!==(r=u.picture)&&void 0!==r&&r.url)&&(0,p.jsx)(t.A,{})}),title:null===u||void 0===u?void 0:u.fullName,description:null===e||void 0===e||null===(c=e.messages[(null===e||void 0===e||null===(v=e.messages)||void 0===v?void 0:v.length)-1])||void 0===c?void 0:c.message})})}})]})};var S=s(20022),_=s(73216),k=s(3825);const I=()=>{const e=(0,S.c)(),l=(0,_.zy)().search.split("receiver=")[1],s=(0,y.wR)(),[o,a]=(0,n.useState)([]),[d,t]=(0,n.useState)(null),[r,c]=(0,n.useState)(!1),[g,h]=(0,n.useState)(null),[x,j]=(0,n.useState)([]),f=async e=>{await v.A.get("".concat("https://www.spelleng.com/api","/users/user/").concat(e)).then((e=>{200===e.status?h(e.data):(0,u.$p)(e.data.errorMessage)})).catch((e=>{console.log(e),(0,u.$p)(null===e||void 0===e?void 0:e.message)}))};(0,n.useEffect)((()=>(e&&(e.emit("join",{userId:null===s||void 0===s?void 0:s._id}),e.emit("users",null===s||void 0===s?void 0:s._id),l&&e.emit("messages",{receiver:l,sender:null===s||void 0===s?void 0:s._id}),e.on("users",(e=>{a(e)})),e.on("only sent to receiver",(e=>{console.log("only sent to receiver",e)})),e.on("messages",(l=>{console.log("all messages got",l),j(l),1===(null===l||void 0===l?void 0:l.length)&&e.emit("users",null===s||void 0===s?void 0:s._id)}))),()=>{e&&e.off("usersList")})),[e,d]),(0,n.useEffect)((()=>(l&&(t(l),f(l)),()=>{})),[l]);return(0,p.jsxs)("div",{className:"chat-container container ".concat(r?"show-user-list":""),children:[(0,p.jsxs)("div",{className:"d-flex",children:[(0,p.jsx)(A,{users:o,selectedUser:d,onSelectUser:l=>{t(l),c(!1),f(l),e.emit("join",{userId:null===s||void 0===s?void 0:s._id}),e.emit("messages",{receiver:l,sender:null===s||void 0===s?void 0:s._id})}}),(0,p.jsx)(i.Ay,{type:"primary",className:"mobileUsersBtn ".concat(r&&"open"),onClick:()=>c(!r),children:r?(0,p.jsx)(m.Z6D,{}):(0,p.jsx)(k.gDr,{})})]}),(0,p.jsxs)("div",{className:"chat-main mt-5 mt-md-0",children:[g?(0,p.jsx)(N,{sender:s,receiver:g,messages:x,onSendMessage:async(l,i)=>{const n=null===s||void 0===s?void 0:s._id;await e.emit("sendMessage",{senderId:n,receiverId:d,message:l,file:i}),(null===x||void 0===x?void 0:x.length)>0?j((e=>[...e,{sender:n,receiver:d,message:l,file:i}])):(e.emit("users",null===s||void 0===s?void 0:s._id),j([{sender:n,receiver:d,message:l,file:i}]))}}):(0,p.jsx)("div",{className:"select-chat",children:"Please select a chat"}),(0,p.jsx)("div",{className:"d-block d-md-none"})]})]})}}}]);
//# sourceMappingURL=3898.cdd9e566.chunk.js.map